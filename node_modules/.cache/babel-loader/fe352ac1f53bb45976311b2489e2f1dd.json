{"ast":null,"code":"import _slicedToArray from\"/Users/sze/Desktop/chatroom-wechat/chatroom/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{Avatar}from'@material-ui/core';import'./SidebarChat.css';import db from'./firebase';import{Link}from'react-router-dom';import{useStateValue}from'./StateProvider';import AddBoxIcon from'@material-ui/icons/AddBox';import ClearIcon from'@material-ui/icons/Clear';import Modal from'@material-ui/core/Modal';import Button from'@material-ui/core/Button';function SidebarChat(_ref){var _messages$2;var addNewChat=_ref.addNewChat,id=_ref.id,name=_ref.name;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),lastMessageTime=_useState4[0],setLastMessageTime=_useState4[1];var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),user=_useStateValue2[0].user,dispatch=_useStateValue2[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),roomName=_useState6[0],setRoomName=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),checkDelete=_useState8[0],setCheckDelete=_useState8[1];var createChat=function createChat(){var roomName=prompt('请输入房间名称');if(roomName){db.collection('rooms').add({name:roomName});setRoomName(roomName);}};useEffect(function(){if(id){db.collection('rooms').doc(id).collection('message').orderBy('time','desc').onSnapshot(function(snapshot){return setMessages(snapshot.docs.map(function(doc){return doc.data();}));});}},[id]);useEffect(function(){var _messages$,_messages$$time;var today=new Date((_messages$=messages[0])===null||_messages$===void 0?void 0:(_messages$$time=_messages$.time)===null||_messages$$time===void 0?void 0:_messages$$time.toDate());var displayTime=today=='Invalid Date'?'':(today.getHours()<10?'0':'')+today.getHours()+':'+(today.getMinutes()<10?'0':'')+today.getMinutes();setLastMessageTime(displayTime);},[messages]);useEffect(function(){if(checkDelete){window.location.href='/';db.collection('rooms').doc(id).delete().then(function(){return window.location.refresh();});}},[checkDelete]);var deleteRoom=function deleteRoom(){document.querySelector('.modal').style.display='block';};var confirmDelete=function confirmDelete(){setCheckDelete(true);};var cancelDelete=function cancelDelete(){document.querySelector('.modal').style.display='none';};return!addNewChat?/*#__PURE__*/React.createElement(Link,{to:\"/rooms/\".concat(id)},/*#__PURE__*/React.createElement(\"div\",{className:\"sidebarChat\"},/*#__PURE__*/React.createElement(Avatar,{src:\"https://avatars.dicebear.com/api/identicon/\".concat(id,\".svg\")}),/*#__PURE__*/React.createElement(\"div\",{className:\"sidebarChat__info\"},/*#__PURE__*/React.createElement(\"h2\",null,name),/*#__PURE__*/React.createElement(\"div\",{className:\"sidebarChat__messageInfo\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sidebarChat__message\"},(_messages$2=messages[0])===null||_messages$2===void 0?void 0:_messages$2.message),/*#__PURE__*/React.createElement(\"div\",{className:\"sidebarChat__timestamp\"},lastMessageTime,/*#__PURE__*/React.createElement(\"span\",{onClick:deleteRoom},/*#__PURE__*/React.createElement(ClearIcon,null))))),/*#__PURE__*/React.createElement(\"div\",{className:\"modal__Container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"modal\"},/*#__PURE__*/React.createElement(\"h3\",null,\"\\u786E\\u8BA4\\u8981\\u5220\\u9664\\u7FA4\\u804A\\u5417\\uFF1F\"),/*#__PURE__*/React.createElement(Button,{variant:\"outlined\",color:\"primary\",onClick:confirmDelete},\"\\u786E\\u8BA4\"),/*#__PURE__*/React.createElement(Button,{variant:\"outlined\",color:\"primary\",onClick:cancelDelete},\"\\u53D6\\u6D88\"))))):/*#__PURE__*/React.createElement(\"div\",{onClick:createChat,className:\"sidebarChat\"},/*#__PURE__*/React.createElement(AddBoxIcon,null),\" \",/*#__PURE__*/React.createElement(\"p\",null,\"\\u521B\\u5EFA\\u65B0\\u623F\\u95F4\"));}export default SidebarChat;","map":{"version":3,"sources":["/Users/sze/Desktop/chatroom-wechat/chatroom/src/SidebarChat.js"],"names":["React","useEffect","useState","Avatar","db","Link","useStateValue","AddBoxIcon","ClearIcon","Modal","Button","SidebarChat","addNewChat","id","name","messages","setMessages","lastMessageTime","setLastMessageTime","user","dispatch","roomName","setRoomName","checkDelete","setCheckDelete","createChat","prompt","collection","add","doc","orderBy","onSnapshot","snapshot","docs","map","data","today","Date","time","toDate","displayTime","getHours","getMinutes","window","location","href","delete","then","refresh","deleteRoom","document","querySelector","style","display","confirmDelete","cancelDelete","message"],"mappings":"kKAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,MAAT,KAAuB,mBAAvB,CACA,MAAO,mBAAP,CACA,MAAOC,CAAAA,EAAP,KAAe,YAAf,CACA,OAASC,IAAT,KAAqB,kBAArB,CACA,OAASC,aAAT,KAA8B,iBAA9B,CACA,MAAOC,CAAAA,UAAP,KAAuB,2BAAvB,CACA,MAAOC,CAAAA,SAAP,KAAsB,0BAAtB,CACA,MAAOC,CAAAA,KAAP,KAAkB,yBAAlB,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CAEA,QAASC,CAAAA,WAAT,MAA+C,oBAAxBC,CAAAA,UAAwB,MAAxBA,UAAwB,CAAZC,EAAY,MAAZA,EAAY,CAARC,IAAQ,MAARA,IAAQ,eACdZ,QAAQ,CAAC,EAAD,CADM,wCACvCa,QADuC,eAC7BC,WAD6B,8BAEAd,QAAQ,CAAC,EAAD,CAFR,yCAEvCe,eAFuC,eAEtBC,kBAFsB,kCAGjBZ,aAAa,EAHI,kDAGrCa,IAHqC,oBAGrCA,IAHqC,CAG7BC,QAH6B,mCAIdlB,QAAQ,CAAC,EAAD,CAJM,yCAIvCmB,QAJuC,eAI7BC,WAJ6B,8BAKRpB,QAAQ,CAAC,KAAD,CALA,yCAKvCqB,WALuC,eAK1BC,cAL0B,eAO9C,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACxB,GAAMJ,CAAAA,QAAQ,CAAGK,MAAM,CAAC,SAAD,CAAvB,CACA,GAAIL,QAAJ,CAAc,CACbjB,EAAE,CAACuB,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2B,CAC1Bd,IAAI,CAAEO,QADoB,CAA3B,EAGAC,WAAW,CAACD,QAAD,CAAX,CACA,CACD,CARD,CAUApB,SAAS,CAAC,UAAM,CACf,GAAIY,EAAJ,CAAQ,CACPT,EAAE,CAACuB,UAAH,CAAc,OAAd,EACEE,GADF,CACMhB,EADN,EAEEc,UAFF,CAEa,SAFb,EAGEG,OAHF,CAGU,MAHV,CAGkB,MAHlB,EAIEC,UAJF,CAIa,SAACC,QAAD,QACXhB,CAAAA,WAAW,CAACgB,QAAQ,CAACC,IAAT,CAAcC,GAAd,CAAkB,SAACL,GAAD,QAASA,CAAAA,GAAG,CAACM,IAAJ,EAAT,EAAlB,CAAD,CADA,EAJb,EAOA,CACD,CAVQ,CAUN,CAACtB,EAAD,CAVM,CAAT,CAYAZ,SAAS,CAAC,UAAM,gCACf,GAAMmC,CAAAA,KAAK,CAAG,GAAIC,CAAAA,IAAJ,aAAStB,QAAQ,CAAC,CAAD,CAAjB,sDAAS,WAAauB,IAAtB,0CAAS,gBAAmBC,MAAnB,EAAT,CAAd,CACA,GAAMC,CAAAA,WAAW,CAChBJ,KAAK,EAAI,cAAT,CACG,EADH,CAEG,CAACA,KAAK,CAACK,QAAN,GAAmB,EAAnB,CAAwB,GAAxB,CAA8B,EAA/B,EACAL,KAAK,CAACK,QAAN,EADA,CAEA,GAFA,EAGCL,KAAK,CAACM,UAAN,GAAqB,EAArB,CAA0B,GAA1B,CAAgC,EAHjC,EAIAN,KAAK,CAACM,UAAN,EAPJ,CASAxB,kBAAkB,CAACsB,WAAD,CAAlB,CACA,CAZQ,CAYN,CAACzB,QAAD,CAZM,CAAT,CAcAd,SAAS,CAAC,UAAM,CACf,GAAIsB,WAAJ,CAAiB,CAChBoB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuB,GAAvB,CACAzC,EAAE,CAACuB,UAAH,CAAc,OAAd,EACEE,GADF,CACMhB,EADN,EAEEiC,MAFF,GAGEC,IAHF,CAGO,iBAAMJ,CAAAA,MAAM,CAACC,QAAP,CAAgBI,OAAhB,EAAN,EAHP,EAIA,CACD,CARQ,CAQN,CAACzB,WAAD,CARM,CAAT,CAUA,GAAM0B,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACxBC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,EAAiCC,KAAjC,CAAuCC,OAAvC,CAAiD,OAAjD,CACA,CAFD,CAIA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CAC3B9B,cAAc,CAAC,IAAD,CAAd,CACA,CAFD,CAIA,GAAM+B,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CAC1BL,QAAQ,CAACC,aAAT,CAAuB,QAAvB,EAAiCC,KAAjC,CAAuCC,OAAvC,CAAiD,MAAjD,CACA,CAFD,CAIA,MAAO,CAACzC,UAAD,cACN,oBAAC,IAAD,EAAM,EAAE,kBAAYC,EAAZ,CAAR,eACC,2BAAK,SAAS,CAAC,aAAf,eACC,oBAAC,MAAD,EAAQ,GAAG,sDAAgDA,EAAhD,QAAX,EADD,cAEC,2BAAK,SAAS,CAAC,mBAAf,eACC,8BAAKC,IAAL,CADD,cAEC,2BAAK,SAAS,CAAC,0BAAf,eACC,2BAAK,SAAS,CAAC,sBAAf,eAAuCC,QAAQ,CAAC,CAAD,CAA/C,sCAAuC,YAAayC,OAApD,CADD,cAEC,2BAAK,SAAS,CAAC,wBAAf,EACEvC,eADF,cAEC,4BAAM,OAAO,CAAEgC,UAAf,eACC,oBAAC,SAAD,MADD,CAFD,CAFD,CAFD,CAFD,cAcC,2BAAK,SAAS,CAAC,kBAAf,eACC,2BAAK,SAAS,CAAC,OAAf,eACC,uFADD,cAEC,oBAAC,MAAD,EAAQ,OAAO,CAAC,UAAhB,CAA2B,KAAK,CAAC,SAAjC,CAA2C,OAAO,CAAEK,aAApD,iBAFD,cAKC,oBAAC,MAAD,EAAQ,OAAO,CAAC,UAAhB,CAA2B,KAAK,CAAC,SAAjC,CAA2C,OAAO,CAAEC,YAApD,iBALD,CADD,CAdD,CADD,CADM,cA8BN,2BAAK,OAAO,CAAE9B,UAAd,CAA0B,SAAS,CAAC,aAApC,eACC,oBAAC,UAAD,MADD,kBACgB,8DADhB,CA9BD,CAkCA,CAED,cAAed,CAAAA,WAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Avatar } from '@material-ui/core';\nimport './SidebarChat.css';\nimport db from './firebase';\nimport { Link } from 'react-router-dom';\nimport { useStateValue } from './StateProvider';\nimport AddBoxIcon from '@material-ui/icons/AddBox';\nimport ClearIcon from '@material-ui/icons/Clear';\nimport Modal from '@material-ui/core/Modal';\nimport Button from '@material-ui/core/Button';\n\nfunction SidebarChat({ addNewChat, id, name }) {\n\tconst [messages, setMessages] = useState('');\n\tconst [lastMessageTime, setLastMessageTime] = useState('');\n\tconst [{ user }, dispatch] = useStateValue();\n\tconst [roomName, setRoomName] = useState('');\n\tconst [checkDelete, setCheckDelete] = useState(false);\n\n\tconst createChat = () => {\n\t\tconst roomName = prompt('请输入房间名称');\n\t\tif (roomName) {\n\t\t\tdb.collection('rooms').add({\n\t\t\t\tname: roomName,\n\t\t\t});\n\t\t\tsetRoomName(roomName);\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tif (id) {\n\t\t\tdb.collection('rooms')\n\t\t\t\t.doc(id)\n\t\t\t\t.collection('message')\n\t\t\t\t.orderBy('time', 'desc')\n\t\t\t\t.onSnapshot((snapshot) =>\n\t\t\t\t\tsetMessages(snapshot.docs.map((doc) => doc.data()))\n\t\t\t\t);\n\t\t}\n\t}, [id]);\n\n\tuseEffect(() => {\n\t\tconst today = new Date(messages[0]?.time?.toDate());\n\t\tconst displayTime =\n\t\t\ttoday == 'Invalid Date'\n\t\t\t\t? ''\n\t\t\t\t: (today.getHours() < 10 ? '0' : '') +\n\t\t\t\t  today.getHours() +\n\t\t\t\t  ':' +\n\t\t\t\t  (today.getMinutes() < 10 ? '0' : '') +\n\t\t\t\t  today.getMinutes();\n\n\t\tsetLastMessageTime(displayTime);\n\t}, [messages]);\n\n\tuseEffect(() => {\n\t\tif (checkDelete) {\n\t\t\twindow.location.href = '/';\n\t\t\tdb.collection('rooms')\n\t\t\t\t.doc(id)\n\t\t\t\t.delete()\n\t\t\t\t.then(() => window.location.refresh());\n\t\t}\n\t}, [checkDelete]);\n\n\tconst deleteRoom = () => {\n\t\tdocument.querySelector('.modal').style.display = 'block';\n\t};\n\n\tconst confirmDelete = () => {\n\t\tsetCheckDelete(true);\n\t};\n\n\tconst cancelDelete = () => {\n\t\tdocument.querySelector('.modal').style.display = 'none';\n\t};\n\n\treturn !addNewChat ? (\n\t\t<Link to={`/rooms/${id}`}>\n\t\t\t<div className='sidebarChat'>\n\t\t\t\t<Avatar src={`https://avatars.dicebear.com/api/identicon/${id}.svg`} />\n\t\t\t\t<div className='sidebarChat__info'>\n\t\t\t\t\t<h2>{name}</h2>\n\t\t\t\t\t<div className='sidebarChat__messageInfo'>\n\t\t\t\t\t\t<div className='sidebarChat__message'>{messages[0]?.message}</div>\n\t\t\t\t\t\t<div className='sidebarChat__timestamp'>\n\t\t\t\t\t\t\t{lastMessageTime}\n\t\t\t\t\t\t\t<span onClick={deleteRoom}>\n\t\t\t\t\t\t\t\t<ClearIcon />\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className='modal__Container'>\n\t\t\t\t\t<div className='modal'>\n\t\t\t\t\t\t<h3>确认要删除群聊吗？</h3>\n\t\t\t\t\t\t<Button variant='outlined' color='primary' onClick={confirmDelete}>\n\t\t\t\t\t\t\t确认\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button variant='outlined' color='primary' onClick={cancelDelete}>\n\t\t\t\t\t\t\t取消\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Link>\n\t) : (\n\t\t<div onClick={createChat} className='sidebarChat'>\n\t\t\t<AddBoxIcon /> <p>创建新房间</p>\n\t\t</div>\n\t);\n}\n\nexport default SidebarChat;\n"]},"metadata":{},"sourceType":"module"}