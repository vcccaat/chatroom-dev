{"ast":null,"code":"import _slicedToArray from\"/Users/sze/Desktop/chatroom-wechat/chatroom/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{Avatar,IconButton}from'@material-ui/core';import MoreHorizIcon from'@material-ui/icons/MoreHoriz';import InsertEmoticonIcon from'@material-ui/icons/InsertEmoticon';import MicIcon from'@material-ui/icons/Mic';import{useParams}from'react-router-dom';import'./Chat.css';import db from'./firebase';import firebase from'firebase';import{useStateValue}from'./StateProvider';export default function Chat(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),input=_useState2[0],setInput=_useState2[1];var _useParams=useParams(),roomId=_useParams.roomId;var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),roomName=_useState4[0],setRoomName=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),messages=_useState6[0],setMessages=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),currentTime=_useState8[0],setcurrentTime=_useState8[1];var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),user=_useStateValue2[0].user,dispatch=_useStateValue2[1];useEffect(function(){var today=new Date();var time=(today.getHours()<10?'0':'')+today.getHours()+':'+(today.getMinutes()<10?'0':'')+today.getMinutes();setcurrentTime(time);});useEffect(function(){if(roomId){db.collection('rooms').doc(roomId).onSnapshot(function(snapshot){setRoomName(snapshot.data().name);});db.collection('rooms').doc(roomId).collection('message').orderBy('time','asc').onSnapshot(function(snapshot){return setMessages(snapshot.docs.map(function(doc){return doc.data();}));});}},[roomId]);var sendMessage=function sendMessage(e){if(roomId){e.preventDefault();if(input.trim()!==''){db.collection('rooms').doc(roomId).collection('message').add({message:input,name:user.displayName,time:firebase.firestore.FieldValue.serverTimestamp()});setInput('');}}};return/*#__PURE__*/React.createElement(\"div\",{className:\"chat\"},/*#__PURE__*/React.createElement(\"div\",{className:\"chat__header\"},/*#__PURE__*/React.createElement(Avatar,{src:\"https://avatars.dicebear.com/api/identicon/\".concat(roomId,\".svg\")}),/*#__PURE__*/React.createElement(\"div\",{className:\"chat__headerInfo\"},/*#__PURE__*/React.createElement(\"h3\",null,roomName)),/*#__PURE__*/React.createElement(\"div\",{className:\"chat__headerRight\"},/*#__PURE__*/React.createElement(IconButton,null,/*#__PURE__*/React.createElement(MoreHorizIcon,null)))),/*#__PURE__*/React.createElement(\"div\",{className:\"chat__body\"},messages.map(function(message,index){return/*#__PURE__*/React.createElement(\"div\",{key:index,className:\"chat__info \".concat(message.name===user.displayName&&'chat__receiver')},/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(message.name===user.displayName&&'chat__receiverIcon')},/*#__PURE__*/React.createElement(Avatar,{src:\"https://avatars.dicebear.com/api/bottts/\".concat(message.name===user.displayName?user.displayName:roomId,\".svg\")})),/*#__PURE__*/React.createElement(\"p\",{className:\"chat__message\"},/*#__PURE__*/React.createElement(\"span\",{className:\"chat__name\"},message.name),message.message));}),/*#__PURE__*/React.createElement(\"div\",{className:\"chat__timestamp\"},/*#__PURE__*/React.createElement(\"p\",null,currentTime))),/*#__PURE__*/React.createElement(\"div\",{className:\"chat__footer\"},/*#__PURE__*/React.createElement(\"div\",{className:\"chat__footerWrap\"},/*#__PURE__*/React.createElement(InsertEmoticonIcon,null),/*#__PURE__*/React.createElement(\"form\",null,/*#__PURE__*/React.createElement(\"input\",{value:input,onChange:function onChange(e){setInput(e.target.value);},maxLength:\"200\",type:\"text\"}),/*#__PURE__*/React.createElement(\"button\",{onClick:sendMessage,type:\"submit\"})),/*#__PURE__*/React.createElement(MicIcon,null))));}","map":{"version":3,"sources":["/Users/sze/Desktop/chatroom-wechat/chatroom/src/Chat.js"],"names":["React","useEffect","useState","Avatar","IconButton","MoreHorizIcon","InsertEmoticonIcon","MicIcon","useParams","db","firebase","useStateValue","Chat","input","setInput","roomId","roomName","setRoomName","messages","setMessages","currentTime","setcurrentTime","user","dispatch","today","Date","time","getHours","getMinutes","collection","doc","onSnapshot","snapshot","data","name","orderBy","docs","map","sendMessage","e","preventDefault","trim","add","message","displayName","firestore","FieldValue","serverTimestamp","index","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Avatar, IconButton } from '@material-ui/core';\nimport MoreHorizIcon from '@material-ui/icons/MoreHoriz';\nimport InsertEmoticonIcon from '@material-ui/icons/InsertEmoticon';\nimport MicIcon from '@material-ui/icons/Mic';\nimport { useParams } from 'react-router-dom';\nimport './Chat.css';\nimport db from './firebase';\nimport firebase from 'firebase';\nimport { useStateValue } from './StateProvider';\n\nexport default function Chat() {\n\tconst [input, setInput] = useState('');\n\tconst { roomId } = useParams();\n\tconst [roomName, setRoomName] = useState('');\n\tconst [messages, setMessages] = useState([]);\n\tconst [currentTime, setcurrentTime] = useState('');\n\tconst [{ user }, dispatch] = useStateValue();\n\n\tuseEffect(() => {\n\t\tconst today = new Date();\n\t\tconst time =\n\t\t\t(today.getHours() < 10 ? '0' : '') +\n\t\t\ttoday.getHours() +\n\t\t\t':' +\n\t\t\t(today.getMinutes() < 10 ? '0' : '') +\n\t\t\ttoday.getMinutes();\n\t\tsetcurrentTime(time);\n\t});\n\n\tuseEffect(() => {\n\t\tif (roomId) {\n\t\t\tdb.collection('rooms')\n\t\t\t\t.doc(roomId)\n\t\t\t\t.onSnapshot((snapshot) => {\n\t\t\t\t\tsetRoomName(snapshot.data().name);\n\t\t\t\t});\n\t\t\tdb.collection('rooms')\n\t\t\t\t.doc(roomId)\n\t\t\t\t.collection('message')\n\t\t\t\t.orderBy('time', 'asc')\n\t\t\t\t.onSnapshot((snapshot) =>\n\t\t\t\t\tsetMessages(snapshot.docs.map((doc) => doc.data()))\n\t\t\t\t);\n\t\t}\n\t}, [roomId]);\n\n\tconst sendMessage = (e) => {\n\t\tif (roomId) {\n\t\t\te.preventDefault();\n\t\t\tif (input.trim() !== '') {\n\t\t\t\tdb.collection('rooms').doc(roomId).collection('message').add({\n\t\t\t\t\tmessage: input,\n\t\t\t\t\tname: user.displayName,\n\t\t\t\t\ttime: firebase.firestore.FieldValue.serverTimestamp(),\n\t\t\t\t});\n\t\t\t\tsetInput('');\n\t\t\t}\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className='chat'>\n\t\t\t<div className='chat__header'>\n\t\t\t\t<Avatar\n\t\t\t\t\tsrc={`https://avatars.dicebear.com/api/identicon/${roomId}.svg`}\n\t\t\t\t/>\n\t\t\t\t<div className='chat__headerInfo'>\n\t\t\t\t\t<h3>{roomName}</h3>\n\t\t\t\t</div>\n\t\t\t\t<div className='chat__headerRight'>\n\t\t\t\t\t<IconButton>\n\t\t\t\t\t\t<MoreHorizIcon />\n\t\t\t\t\t</IconButton>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className='chat__body'>\n\t\t\t\t{messages.map((message, index) => (\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\tclassName={`chat__info ${\n\t\t\t\t\t\t\tmessage.name === user.displayName && 'chat__receiver'\n\t\t\t\t\t\t}`}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={`${\n\t\t\t\t\t\t\t\tmessage.name === user.displayName && 'chat__receiverIcon'\n\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\tsrc={`https://avatars.dicebear.com/api/bottts/${\n\t\t\t\t\t\t\t\t\tmessage.name === user.displayName ? user.displayName : roomId\n\t\t\t\t\t\t\t\t}.svg`}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className='chat__message'>\n\t\t\t\t\t\t\t<span className='chat__name'>{message.name}</span>\n\t\t\t\t\t\t\t{message.message}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t\t<div className='chat__timestamp'>\n\t\t\t\t\t<p>{currentTime}</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className='chat__footer'>\n\t\t\t\t<div className='chat__footerWrap'>\n\t\t\t\t\t<InsertEmoticonIcon />\n\t\t\t\t\t<form>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tvalue={input}\n\t\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\t\tsetInput(e.target.value);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tmaxLength='200'\n\t\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button onClick={sendMessage} type='submit'></button>\n\t\t\t\t\t</form>\n\t\t\t\t\t<MicIcon />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"]},"metadata":{},"sourceType":"module"}