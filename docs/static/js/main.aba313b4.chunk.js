(this.webpackJsonpchatroom=this.webpackJsonpchatroom||[]).push([[0],{100:function(e,a,t){"use strict";t.r(a);var n=t(0),c=t.n(n),r=t(20),o=t.n(r),l=(t(74),t(6)),i=(t(75),t(76),t(127)),s=t(119),m=t(60),u=t.n(m),d=(t(77),t(42)),h=t.n(d),E=h.a.initializeApp({apiKey:"AIzaSyCy6gePCn95u8zMOLT4UTORjrHDvhRrO2g",authDomain:"chat-49c1d.firebaseapp.com",databaseURL:"https://chat-49c1d.firebaseio.com",projectId:"chat-49c1d",storageBucket:"chat-49c1d.appspot.com",messagingSenderId:"689541832725",appId:"1:689541832725:web:a747e231a0e0f9998e2e1c",measurementId:"G-H8CSC7SKMV"}).firestore(),p=h.a.auth(),f=h.a.firestore.FieldValue.serverTimestamp(),g=t(7),v=t(29),b=t(59),_=t.n(b),N=t(58),O=t.n(N);t(88);var j=function(e){var a=e.title,t=e.content,n=e.visible,r=e.hide,l=e.confirm;return n?o.a.createPortal(c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"modal-wrapper"},c.a.createElement("div",{className:"modal"},c.a.createElement("div",{className:"modal-title"},a),c.a.createElement("div",{className:"modal-content"},t),c.a.createElement("div",{className:"modal-operator"},c.a.createElement("button",{className:"modal-operator-confirm",onClick:l},"\u786e\u8ba4"),c.a.createElement("button",{className:"modal-operator-close",onClick:r},"\u53d6\u6d88"))),c.a.createElement("div",{className:"mask"}))),document.body):null},S=function(){var e=Object(n.useState)(!1),a=Object(l.a)(e,2),t=a[0],c=a[1];return{isShowing:t,toggle:function(){c(!t)}}};var y=function(e){var a,t=e.addNewChat,r=e.id,o=e.name,s=Object(n.useState)(""),m=Object(l.a)(s,2),u=m[0],d=m[1],h=Object(n.useState)(""),p=Object(l.a)(h,2),f=p[0],b=p[1],N=S(),y=N.isShowing,C=N.toggle,w=Object(g.f)();return Object(n.useEffect)((function(){r&&E.collection("rooms").doc(r).collection("message").orderBy("time","desc").onSnapshot((function(e){return d(e.docs.map((function(e){return e.data()})))}),(function(e){console.error("Error getting message of the room: ",r,e)}))}),[r]),Object(n.useEffect)((function(){var e,a,t=new Date(null===(e=u[0])||void 0===e||null===(a=e.time)||void 0===a?void 0:a.toDate()),n="Invalid Date"==t?"":(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes();b(n)}),[u]),t?c.a.createElement("div",{onClick:function(){var e=prompt("\u8bf7\u8f93\u5165\u623f\u95f4\u540d\u79f0");e&&E.collection("rooms").add({name:e})},className:"sidebarChat"},c.a.createElement(_.a,null)," ",c.a.createElement("p",null,"\u521b\u5efa\u65b0\u623f\u95f4")):c.a.createElement(v.b,{to:"/chatroom/".concat(r)},c.a.createElement("div",{className:"sidebarChat"},c.a.createElement(i.a,{src:"https://avatars.dicebear.com/api/identicon/".concat(r,".svg")}),c.a.createElement("div",{className:"sidebarChat__room"},c.a.createElement("div",{className:"sidebarChat__roomName"},o),c.a.createElement("div",{className:"sidebarChat__messageInfo"},c.a.createElement("div",{className:"sidebarChat__lastMessage"},null===(a=u[0])||void 0===a?void 0:a.message),c.a.createElement("div",{className:"sidebarChat__timestamp"},f),c.a.createElement("div",{className:"sidebarChat__delete",onClick:C},c.a.createElement(O.a,null),c.a.createElement(j,{visible:y,hide:C,title:"\u6ce8\u610f",roomName:o,content:"\u786e\u8ba4\u8981\u5220\u9664 ".concat(o," \u7fa4\u804a\u5417\uff1f"),confirm:function(e){e.preventDefault(),w.push("/chatroom"),E.collection("rooms").doc(r).delete().then((function(){console.log("Document successfully deleted!")})).catch((function(e){console.error("Error removing document: ",e)}))}}))))))},C=Object(n.createContext)(),w=function(e){var a=e.reducer,t=e.initialState,r=e.children;return c.a.createElement(C.Provider,{value:Object(n.useReducer)(a,t)},r)},k=function(){return Object(n.useContext)(C)};var I=function(){var e=Object(n.useState)([]),a=Object(l.a)(e,2),t=a[0],r=a[1],o=k(),m=Object(l.a)(o,1)[0].user;return Object(n.useEffect)((function(){var e=E.collection("rooms").onSnapshot((function(e){return r(e.docs.map((function(e){return{id:e.id,data:e.data()}})))}),(function(e){console.error("Error loading chatting rooms ",e)}));return function(){e()}}),[]),c.a.createElement("div",{className:"sidebar"},c.a.createElement("div",{className:"sidebar__header"},c.a.createElement(i.a,{src:"https://avatars.dicebear.com/api/bottts/".concat(m.displayName,".svg")}),c.a.createElement("h2",null,m.displayName),c.a.createElement("div",{className:"sidebar__headerRight",onClick:function(){localStorage.clear(),window.location.reload()}},c.a.createElement(s.a,null,c.a.createElement(u.a,null)))),c.a.createElement("div",{className:"sidebar__chats"},c.a.createElement(y,{addNewChat:!0}),t.map((function(e){return c.a.createElement(y,{key:e.id,id:e.id,name:e.data.name})}))))},D=t(125),M=t(61),H=t.n(M),R=t(62),x=t.n(R),P=t(63),B=t.n(P);t(98);function L(){var e=Object(n.useState)(""),a=Object(l.a)(e,2),t=a[0],r=a[1],o=Object(g.g)().roomId,m=Object(n.useState)(""),u=Object(l.a)(m,2),d=u[0],h=u[1],p=Object(n.useState)([]),v=Object(l.a)(p,2),b=v[0],_=v[1],N=Object(n.useState)(""),O=Object(l.a)(N,2),j=O[0],S=O[1],y=k(),C=Object(l.a)(y,1)[0].user;Object(n.useEffect)((function(){var e,a,t=new Date(null===(e=b[b.length-1])||void 0===e||null===(a=e.time)||void 0===a?void 0:a.toDate()),n="Invalid Date"==t?"":t.getMonth()+"\u6708"+t.getDate()+"\u65e5     "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes();S(n)}),[b]),Object(n.useEffect)((function(){o&&(E.collection("rooms").doc(o).onSnapshot((function(e){e.data()&&h(e.data().name)}),(function(e){console.error("Error loading the room name ",e)})),E.collection("rooms").doc(o).collection("message").orderBy("time","asc").onSnapshot((function(e){return _(e.docs.map((function(e){return e.data()})))}),(function(e){console.error("Error loading the messages of the room: ",o,e)})))}),[o]);return c.a.createElement("div",{className:"chat"},c.a.createElement("div",{className:"chat__header"},c.a.createElement(i.a,{src:"https://avatars.dicebear.com/api/identicon/".concat(o,".svg")}),c.a.createElement("div",{className:"chat__headerInfo"},c.a.createElement("div",{className:"chat__headerRoomName"},d),c.a.createElement("div",{className:"chat__timestamp"},c.a.createElement("p",null,"\u6700\u8fd1\u4e00\u6b21\u804a\u5929 ",j))),c.a.createElement("div",{className:"chat__headerRight"},c.a.createElement(s.a,null,c.a.createElement(H.a,null)))),c.a.createElement("div",{className:"chat__body"},b.map((function(e,a){return c.a.createElement("div",{key:a,className:"chat__info ".concat(e.name===C.displayName&&"chat__receiver")},c.a.createElement("div",{className:"".concat(e.name===C.displayName&&"chat__receiverIcon")},c.a.createElement(i.a,{src:"https://avatars.dicebear.com/api/bottts/".concat(e.name,".svg")})),c.a.createElement("div",{className:"chat__message"},c.a.createElement("p",{className:"chat__name"},e.name),c.a.createElement("p",{className:"chat__time"},e.name===C.displayName?"":function(e){var a=new Date(e.toDate());return(a.getHours()<10?"0":"")+a.getHours()+":"+(a.getMinutes()<10?"0":"")+a.getMinutes()}(e.time)),c.a.createElement("p",{className:"chat__content"},e.message)))}))),c.a.createElement("div",{className:"chat__footer"},c.a.createElement("div",{className:"chat__footerWrap"},c.a.createElement(x.a,null),c.a.createElement("form",null,c.a.createElement(D.a,{className:"chat__footerInput",disableUnderline:!0,value:t,onChange:function(e){r(e.target.value)},maxLength:"200",type:"text"}),c.a.createElement("button",{onClick:function(e){o&&(e.preventDefault(),""!==t.trim()&&(E.collection("rooms").doc(o).collection("message").add({message:t,name:C.displayName,time:f}).catch((function(e){console.error("Error sending message: ",t,e)})),r("")))},type:"submit"})),c.a.createElement(B.a,null))))}var U=t(64),W=(t(99),t(46)),A={user:localStorage?JSON.parse(localStorage.getItem("myValueInLocalStorage")):null},J="SET_USER",T=function(e,a){switch(localStorage.setItem("myValueInLocalStorage",JSON.stringify(a.user)),a.type){case J:return Object(W.a)(Object(W.a)({},e),{},{user:a.user});default:return e}},V=t(120),z=t(121),F=t(122),K=t(123);var G=function(){var e=k(),a=Object(l.a)(e,2);Object(U.a)(a[0]);var t=a[1],r=Object(n.useState)(""),o=Object(l.a)(r,2),i=o[0],s=o[1],m=Object(n.useState)(""),u=Object(l.a)(m,2),d=u[0],h=u[1],E=Object(n.useState)(""),f=Object(l.a)(E,2),g=f[0],v=f[1],b=Object(n.useState)(!0),_=Object(l.a)(b,2),N=_[0],O=_[1],j=function(){O(!0)};return N?c.a.createElement("div",{className:"login"},c.a.createElement(V.a,{className:"login__container"},c.a.createElement(z.a,{container:!0,direction:"column"},c.a.createElement(F.a,{variant:"h4"},"\u4e00\u8d77\u6765\u804a\u5929\u5427"),c.a.createElement("input",{onChange:function(e){return s(e.target.value)},id:"email",type:"email",placeholder:"\u90ae\u7bb1"}),c.a.createElement("input",{onChange:function(e){return h(e.target.value)},id:"password",type:"password",placeholder:"\u5bc6\u7801"}),c.a.createElement(K.a,{className:"signin__button",onClick:function(){p.signInWithEmailAndPassword(i,d).then((function(e){t({type:J,user:e.user})})).catch((function(e){return alert(e.message)}))}},"\u767b\u5f55\u8d26\u53f7"),c.a.createElement(K.a,{className:"register__button",onClick:function(){O(!1)}},"\u6ce8\u518c\u8d26\u53f7")))):c.a.createElement("div",{className:"login"},c.a.createElement(V.a,{className:"login__container"},c.a.createElement(z.a,{container:!0,direction:"column"},c.a.createElement(F.a,{variant:"h4"},"\u6ce8\u518c\u7528\u6237"),c.a.createElement("input",{onChange:function(e){return v(e.target.value)},id:"name",type:"text",placeholder:"\u7528\u6237\u540d"}),c.a.createElement("input",{onChange:function(e){return s(e.target.value)},id:"email2",type:"email",placeholder:"\u90ae\u7bb1"}),c.a.createElement("input",{onChange:function(e){return h(e.target.value)},id:"password2",type:"password",placeholder:"\u5bc6\u7801"}),c.a.createElement(K.a,{className:"signin__button",onClick:function(){p.createUserWithEmailAndPassword(i,d).then((function(e){return e.user.updateProfile({displayName:g})})).then(alert("\u6210\u529f\u6ce8\u518c\u5566\uff01")).catch((function(e){return alert(e.message)})),j()}},"\u6ce8\u518c"),c.a.createElement(K.a,{className:"register__button",onClick:j},"\u8fd4\u56de\u767b\u5f55\u9875\u9762"))))},$=t(65),q=t(124),Q=t(126);var X=function(){var e=k(),a=Object(l.a)(e,1)[0].user,t=Object(n.useState)(!0),r=Object(l.a)(t,2),o=r[0],i=r[1],s=Object($.a)({palette:{type:o?"dark":"light",background:{paper:o?"#303030":"#ededed"}}});return c.a.createElement(q.a,{theme:s},c.a.createElement("div",{className:"app"},c.a.createElement("span",{className:"toggle"},"Dark Mode",c.a.createElement(Q.a,{color:"primary",checked:o,onChange:function(){return i(!o)}})),c.a.createElement(v.a,null,a?c.a.createElement(V.a,null,c.a.createElement(z.a,{container:!0,direction:"column"},c.a.createElement("div",{className:"app__body"},c.a.createElement(I,null),c.a.createElement(g.c,null,c.a.createElement(g.a,{path:"/chatroom/:roomId"},c.a.createElement(L,null)),c.a.createElement(g.a,{path:"/chatroom"},c.a.createElement(L,null)))))):c.a.createElement(g.a,{path:"/chatroom"},c.a.createElement(G,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(w,{initialState:A,reducer:T},c.a.createElement(X,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},69:function(e,a,t){e.exports=t(100)},74:function(e,a,t){},75:function(e,a,t){},76:function(e,a,t){},77:function(e,a,t){},88:function(e,a,t){},98:function(e,a,t){},99:function(e,a,t){}},[[69,1,2]]]);
//# sourceMappingURL=main.aba313b4.chunk.js.map